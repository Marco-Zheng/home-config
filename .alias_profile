#!/bin/bash

# ===== Env =====

if [[ "$PROJECT_HOME" == "" ]] then
    echo "Missing Environment Variable `PROJECT_HOME`"
fi

## Golang
if [[ "$PROJECT_HOME" != "" ]] then
    export GOPATH="$PROJECT_HOME/go"
    export PATH="$GOPATH/bin:$PATH"
fi

alias dlv-attach="dlv --listen=:2345 --headless=true --api-version=2 attach"

alias dlv-exec="dlv --listen=:2345 --headless=true --api-version=2 exec"

## Istio
export ISTIO_HOME=$PROJECT_HOME/istio/istio-$ISTIO_VERSION
if [[ -d "$ISTIO_HOME" ]] then
    export PATH=$ISTIO_HOME/bin:$PATH
    source $ISTIO_HOME/tools/_istioctl
fi

## Kubernetes

export PATH="$HOME/.krew/bin:$PATH"

alias pod-name="kubectl get pod -l app=$1 -o jsonpath=\"{.items[0].metadata.name}\""

alias kind="KUBECONFIG=$HOME/.kube/config kind"

alias minikube="KUBECONFIG=$HOME/.kube/config minikube"

KUBE_CACHED_IMAGES=(
    dozer47528/devops-toolkits-docker:latest,debug
    nginx:stable,debug
    golang:1.15,debug
)

if [[ -d "$ISTIO_HOME" ]] && [[ -x "$(command -v jq)" ]] then
    KUBE_CACHED_IMAGES+=(
        istio/proxyv2:${ISTIO_VERSION},istio
        istio/pilot:${ISTIO_VERSION},istio
    )
fi

## Misc

alias mysql="mysql --default-character-set utf8mb4"

export PATH="$HOME/.bin:$PATH"

export PPROF_TMPDIR=/tmp/pprof

alias vi=vim